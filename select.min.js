/**
 * jQuery selectList
 *
 * @author Monwara LLC / Branko Vukelic <branko@monwara.com>
 * @version 0.0.2
 * @license MIT
 */(function(e,t){typeof define=="function"&&define.amd?define(["jquery","makefit"],t):t(jQuery)})(this,function(e){e(window).on("focus","a.select-list",function(t){var n=e(this);if(n.data("select")!==!0)return;var r=n.data("list");if(!r||!r.length)return;var i=n.data("opts");if(r.length>2){if(n.data("listelement"))return;var s=r.map(function(e){return'<div class="'+i.prefix+'-item" '+'data-value="'+e[0]+'">'+e[1]+"</div>"}).join(""),o=e('<div class="'+i.prefix+'-list">'+s+"</div>");n.data("listelement",o);o.css({"z-index":Math.pow(2,32)});o.find("div").each(function(t,r){e(r).data("value")==n.data("input").val()&&e(r).addClass("selected")});o.appendTo("body");o.relativeTo(n);o.on("click","."+i.prefix+"-item",function(t){var r=e(this).text(),i=e(this).data("value");n.data("label",r);n.data("val",i);n.text(r);n.data("input").val(i).change()})}else if(r.length===2){var u=r.filter(function(e){return e[0]!==n.data("val")})[0];n.data("val",u[0]);n.data("label",u[1]);n.text(u[1]);n.data("input").val(u[0]).change()}});var t=!1;e(window).on("click","a.select-list",function(n){if(!!t)return!1;n.preventDefault();n.stopPropagation();e(this).focus();t=!0});e(window).on("blur","a.select-list",function(n){var r=e(this);setTimeout(function(){if(!r.data("listelement"))return;r.data("listelement").remove();r.data("listelement",null);t=!1},150)});e(window).on("keydown","a.select-list",function(t){var n=t.which,r,i,s,o=e(this),u=o.data("listelement"),a=o.data("list");if(u&&a.length>1&&u&&o.data("list").length>1){r=u.find(".selected");if(r.length){i=r.next();i=i.length?i:u.find("div").filter(":first");s=r.prev();s=s.length?s:u.find("div").filter(":last")}else{i=u.find("div").filter(":first");s=u.find("div").filter(":last")}}switch(n){case 40:if(!u)return o.focus();if(a.length<2)return o.click();u.find(".selected").removeClass("selected");i.addClass("selected");o.data("input").val(i.data("value"));o.text(i.text());o.data("val",i.data("value"));o.data("label",i.text());t.preventDefault();t.stopPropagation();break;case 38:if(!u)return;if(a.length<2)return o.click();u.find(".selected").removeClass("selected");s.addClass("selected");o.data("input").val(s.data("value"));o.text(s.text());o.data("val",s.data("value"));o.data("label",s.text());t.preventDefault();t.stopPropagation();break;case 13:case 27:if(!u)return;u.remove();o.data("listelement",null);t.preventDefault();t.stopPropagation()}});var n={prefix:"jquery-select",opts:null};e.fn.selectList=function(t,r){return e(this).map(function(i,s){if(typeof t!="object"){r=t;t={}}t=e.extend({},n,t);var o=e(s);if(o.data("select")===!0){o.data("opts",t);o.data("list",t.opts?t.opts:$this.data("list"));o.data("input").val(r);return}var u=[],a,f;if(t.opts){u=t.opts;if(typeof r!="undefined"){a=r.toString();f=u.length?u.filter(function(e){return e[0]===a})[0][1]:""}}else o.find("option").each(function(t,n){n=e(n);u.push([n.val(),n.text()]);if(n.is("selected")){a=n.val();f=n.text()}});a=a||u.length?u[0][0]:null;f=f||a?u[0][1]:"";var l=e('<input type="hidden" class="select-list">');o.attr("name")&&l.attr("name",o.attr("name"));o.attr("id")&&l.attr("id",o.attr("id"));o.replaceWith(l);var c=e('<a href="JavaScript:void(0)" class="'+t.prefix+'-label select-list"></a>');o.attr("id")&&c.attr("id",o.attr("id")+"-label");l.after(c);l.data({label:c,select:!0});c.data({list:u,val:a,label:f,input:l,opts:t,select:!0});l.change(function(e){var t=l.val(),n=c.data("list");n.forEach(function(e){if(t==e[0]){c.text(e[1]);c.data("label",e[1]);c.data("val",t)}})});if(a){l.val(a);c.text(u.filter(function(e){return a===e[0]})[0][1])}else{l.val(u[0][0]);c.text(u[0][1])}return l})};e.fn.linkTo=function(t,n){var r=e(this);if(!r.data("select"))return;var i=r.data("label");e(t).change(function(t){var s=n(e(this).val(),i.data("val"),i.data("label"),i.data("list"));i.data("list",s[0]);i.data("val",s[1]);i.data("label",s[2]);r.val(s[1]);i.text(s[2])});return r}});