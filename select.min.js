/**
 * jQuery selectList
 *
 * @author Monwara LLC / Branko Vukelic <branko@monwara.com>
 * @version 0.0.1
 * @license MIT
 */(function(a,b){typeof define=="function"&&define.amd?define(["jquery","makefit"],b):b(jQuery)})(this,function(a){a(window).on("focus","a.select-list",function(b){var c=a(this);if(c.data("select")!==!0)return;var d=c.data("list");if(!d||!d.length)return;var e=c.data("opts");if(d.length>2){if(c.data("listelement"))return;var f=d.map(function(a){return'<div class="'+e.prefix+'-item" '+'data-value="'+a[0]+'">'+a[1]+"</div>"}).join(""),g=a('<div class="'+e.prefix+'-list">'+f+"</div>");c.data("listelement",g),g.css({"z-index":Math.pow(2,32)}),g.find("div").each(function(b,d){a(d).data("value")==c.data("input").val()&&a(d).addClass("selected")}),g.appendTo("body"),g.relativeTo(c),g.on("click","."+e.prefix+"-item",function(b){var d=a(this).text(),e=a(this).data("value");c.data("label",d),c.data("val",e),c.text(d),c.data("input").val(e).change()})}else if(d.length===2){var h=d.filter(function(a){return a[0]!==c.data("val")})[0];c.data("val",h[0]),c.data("label",h[1]),c.text(h[1]),c.data("input").val(h[0]).change()}}),a(window).on("click","a.select-list",function(b){b.preventDefault(),b.stopPropagation(),a(this).focus()}),a(window).on("blur","a.select-list",function(b){var c=a(this);setTimeout(function(){if(!c.data("listelement"))return;c.data("listelement").remove(),c.data("listelement",null)},150)}),a(window).on("keydown","a.select-list",function(b){var c=b.which,d,e,f,g=a(this),h=g.data("listelement"),i=g.data("list");h&&i.length>1&&h&&g.data("list").length>1&&(d=h.find(".selected"),d.length?(e=d.next(),e=e.length?e:h.find("div").filter(":first"),f=d.prev(),f=f.length?f:h.find("div").filter(":last")):(e=h.find("div").filter(":first"),f=h.find("div").filter(":last")));switch(c){case 40:if(!h)return g.focus();if(i.length<2)return g.click();h.find(".selected").removeClass("selected"),e.addClass("selected"),g.data("input").val(e.data("value")),g.text(e.text()),g.data("val",e.data("value")),g.data("label",e.text()),b.preventDefault(),b.stopPropagation();break;case 38:if(!h)return;if(i.length<2)return g.click();h.find(".selected").removeClass("selected"),f.addClass("selected"),g.data("input").val(f.data("value")),g.text(f.text()),g.data("val",f.data("value")),g.data("label",f.text()),b.preventDefault(),b.stopPropagation();break;case 13:case 27:if(!h)return;h.remove(),g.data("listelement",null),b.preventDefault(),b.stopPropagation()}});var b={prefix:"jquery-select",opts:null};a.fn.select=function(c,d){return a(this).map(function(e,f){typeof c!="object"&&(d=c,c={}),c=a.extend({},b,c);var g=a(f);if(g.data("select")===!0){g.data("opts",c),g.data("list",c.opts?c.opts:$this.data("list")),g.data("input").val(d);return}var h=[],i,j;c.opts?(h=c.opts,typeof d!="undefined"&&(i=d.toString(),j=h.length?h.filter(function(a){return a[0]===i})[0][1]:"")):g.find("option").each(function(b,c){c=a(c),h.push([c.val(),c.text()]),c.is("selected")&&(i=c.val(),j=c.text())}),i=i||h.length?h[0][0]:null,j=j||i?h[0][1]:"";var k=a('<input type="hidden" class="select-list">');g.attr("name")&&k.attr("name",g.attr("name")),g.attr("id")&&k.attr("id",g.attr("id")),g.replaceWith(k);var l=a('<a href="JavaScript:void(0)" class="'+c.prefix+'-label select-list"></a>');return g.attr("id")&&l.attr("id",g.attr("id")+"-label"),k.after(l),k.data({label:l,select:!0}),l.data({list:h,val:i,label:j,input:k,opts:c,select:!0}),k.change(function(a){var b=k.val(),c=l.data("list");c.forEach(function(a){b==a[0]&&(l.text(a[1]),l.data("label",a[1]),l.data("val",b))})}),i?(k.val(i),l.text(h.filter(function(a){return i===a[0]})[0][1])):(k.val(h[0][0]),l.text(h[0][1])),k})},a.fn.linkTo=function(b,c){var d=a(this);if(!d.data("select"))return;var e=d.data("label");return a(b).change(function(b){var f=c(a(this).val(),e.data("val"),e.data("label"),e.data("list"));e.data("list",f[0]),e.data("val",f[1]),e.data("label",f[2]),d.val(f[1]),e.text(f[2])}),d}});